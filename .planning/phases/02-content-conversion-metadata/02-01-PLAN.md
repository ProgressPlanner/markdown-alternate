---
phase: 02-content-conversion-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - composer.json
  - src/Converter/MarkdownConverter.php
autonomous: true

must_haves:
  truths:
    - "league/html-to-markdown library is installed and autoloadable"
    - "MarkdownConverter class converts HTML strings to markdown"
    - "Converter strips dangerous HTML tags (script, style, iframe)"
  artifacts:
    - path: "composer.json"
      provides: "league/html-to-markdown dependency"
      contains: "league/html-to-markdown"
    - path: "vendor/league/html-to-markdown"
      provides: "Installed library"
    - path: "src/Converter/MarkdownConverter.php"
      provides: "HTML to markdown conversion wrapper"
      exports: ["MarkdownConverter::convert"]
  key_links:
    - from: "src/Converter/MarkdownConverter.php"
      to: "League\\HTMLToMarkdown\\HtmlConverter"
      via: "use statement and instantiation"
      pattern: "use League\\\\HTMLToMarkdown\\\\HtmlConverter"
---

<objective>
Install league/html-to-markdown and create wrapper class for HTML-to-markdown conversion.

Purpose: Establish the conversion infrastructure that ContentRenderer will use to transform post HTML into clean markdown. The league library handles 170+ HTML edge cases (tables, nested lists, code blocks).

Output: Composer dependency installed, MarkdownConverter class ready for use
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-content-conversion-metadata/02-RESEARCH.md

Existing files to reference:
@composer.json
@src/Plugin.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install league/html-to-markdown and create MarkdownConverter</name>
  <files>
    - composer.json
    - src/Converter/MarkdownConverter.php
  </files>
  <action>
1. Run `composer require league/html-to-markdown ^5.1` to add the dependency

2. Create `src/Converter/MarkdownConverter.php`:
   - Namespace: `MarkdownAlternate\Converter`
   - Class wraps `League\HTMLToMarkdown\HtmlConverter`
   - Constructor creates HtmlConverter with these options:
     - `header_style` => `atx` (use # style headers)
     - `strip_tags` => `true` (remove unknown HTML tags)
     - `remove_nodes` => `script style iframe` (security: remove dangerous tags)
     - `hard_break` => `false` (standard markdown line breaks)
     - `list_item_style` => `-` (use - for list items)
   - Public method `convert(string $html): string`:
     - Trim input
     - Return empty string if empty input
     - Call `$this->converter->convert($html)` and return result

Follow existing code style (short array syntax, no Yoda conditions, PHPDoc blocks).
  </action>
  <verify>
1. `composer show league/html-to-markdown` shows version 5.1.x installed
2. `php -r "require 'vendor/autoload.php'; new MarkdownAlternate\Converter\MarkdownConverter();"` runs without error
3. File `src/Converter/MarkdownConverter.php` exists with convert() method
  </verify>
  <done>
- composer.json includes `league/html-to-markdown` ^5.1 in require section
- vendor/league/html-to-markdown directory exists
- MarkdownConverter class is autoloadable and instantiable
- convert() method accepts HTML string and returns markdown string
  </done>
</task>

</tasks>

<verification>
Run these commands to verify the plan is complete:

```bash
# 1. Verify Composer dependency installed
composer show league/html-to-markdown

# 2. Verify class is autoloadable
php -r "require 'vendor/autoload.php'; \$c = new MarkdownAlternate\Converter\MarkdownConverter(); echo 'OK';"

# 3. Verify conversion works
php -r "
require 'vendor/autoload.php';
\$c = new MarkdownAlternate\Converter\MarkdownConverter();
\$html = '<h1>Test</h1><p>Hello <strong>world</strong></p>';
\$md = \$c->convert(\$html);
echo \$md;
"
# Expected output contains: # Test and **world**

# 4. Verify security - script tags stripped
php -r "
require 'vendor/autoload.php';
\$c = new MarkdownAlternate\Converter\MarkdownConverter();
\$html = '<p>Safe</p><script>alert(1)</script>';
\$md = \$c->convert(\$html);
echo strpos(\$md, 'script') === false ? 'SECURE' : 'INSECURE';
"
# Expected: SECURE
```
</verification>

<success_criteria>
- [ ] `league/html-to-markdown` ^5.1 installed via Composer
- [ ] `src/Converter/MarkdownConverter.php` exists with proper namespace
- [ ] MarkdownConverter::convert() transforms HTML to markdown
- [ ] Dangerous tags (script, style, iframe) are stripped
- [ ] Empty input returns empty string (no errors)
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-conversion-metadata/02-01-SUMMARY.md`
</output>
